#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
–ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ –∂–∞–ª–æ–±–∞—Ö –≤ CSV —Ñ–∞–π–ª–µ Sheets
"""

import pandas as pd
from pathlib import Path

# –°–ª–æ–≤–∞—Ä—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
CORRECTIONS = {
    # –°–ª—É–∂–±–∞ 101
    '1. –ö–µ–ª–∏–± —ë—Ä–¥–∞–º –∫—û—Ä—Å–∞—Ç–∏–ª–º–∞–≥–∞–Ω.': '1. –ö–µ–ª–∏–± —ë—Ä–¥–∞–º –∫—û—Ä—Å–∞—Ç–º–∞–≥–∞–Ω.',
    '1.  –ë–æ“ì–ª–∞–Ω–∏—à–≥–∞–Ω –ª–µ–∫–∏–Ω –∫–µ–ª–∏—à–¥–∞–Ω –±–æ—à —Ç–æ—Ä—Ç–∏—à–≥–∞–Ω.': '1. –ë–æ“ì–ª–∞–Ω–≥–∞–Ω, –ª–µ–∫–∏–Ω –∫–µ–ª–∏—à–¥–∞–Ω –±–æ—à —Ç–æ—Ä—Ç–≥–∞–Ω.',
    '1. 1 —Å–æ–∞—Ç–≥–∞—á–∞ –∫–µ—á “õ–æ–ª–∏–± –∫–µ–ª–∏—à–≥–∞–Ω.': '1. 1 —Å–æ–∞—Ç–≥–∞—á–∞ –∫–µ—á “õ–æ–ª–∏–± –∫–µ–ª–≥–∞–Ω.',
    '1. “ö—û–ø–æ–ª –º—É–æ–º–∞–ª–∞–¥–∞ –±—û–ª–≥–∞–Ω': '1. “ö—û–ø–æ–ª –º—É–æ–º–∞–ª–∞–¥–∞ –±—û–ª–≥–∞–Ω.',
    
    # –°–ª—É–∂–±–∞ 102
    '2. “≤–µ—á –∫–∏–º –±–æ“ì–ª–∞–Ω–º–∞–≥–∞–Ω, –∫–µ–ª–º–∞–≥–∞–Ω, —á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω.': '2. “≤–µ—á –∫–∏–º –±–æ“ì–ª–∞–Ω–º–∞–≥–∞–Ω, –∫–µ–ª–º–∞–≥–∞–Ω, —á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω.',
    '2. –•–æ–¥–∏–º –±–æ“ì–ª–∞–Ω–≥–∞–Ω, –ª–µ–∫–∏–Ω –∫–µ–ª–º–∞–≥–∞–Ω, —á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω.': '2. –•–æ–¥–∏–º –±–æ“ì–ª–∞–Ω–≥–∞–Ω, –ª–µ–∫–∏–Ω –∫–µ–ª–º–∞–≥–∞–Ω, —á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω.',
    '2. –ò–∂–æ–±–∏–π “≥–∞–ª “õ–∏–ª–∏–Ω–º–∞–≥–∞–Ω–∏–¥–∞–Ω –Ω–æ—Ä–æ–∑–∏ / “ö–æ–Ω—É–Ω–∏–π —á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω–∏–¥–∞–Ω –Ω–æ—Ä–æ–∑–∏': '2. –ò–∂–æ–±–∏–π “≥–∞–ª “õ–∏–ª–∏–Ω–º–∞–≥–∞–Ω–∏–¥–∞–Ω –Ω–æ—Ä–æ–∑–∏ / “ö–æ–Ω—É–Ω–∏–π—á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω–∏–¥–∞–Ω –Ω–æ—Ä–æ–∑–∏.',
    '2. –•–æ–¥–∏–º –±–æ“ì–ª–∞–Ω–≥–∞–Ω, –∫–µ–ª–≥–∞–Ω, —á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω.': '2. –•–æ–¥–∏–º –±–æ“ì–ª–∞–Ω–≥–∞–Ω, –∫–µ–ª–≥–∞–Ω, —á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω.',
    '2. –ò–ò–ë —Ö–æ–¥–∏–º–∏ –®–∏—Ñ–æ—Ö–æ–Ω–∞–¥–∞–Ω –º–∞—ä–ª—É–º–æ—Ç–Ω–æ–º–∞ –æ–ª–∏–± –∫–µ—Ç–º–∞–≥–∞–Ω / –º–∞—ä–ª—É–º–æ—Ç –æ–ª–∏–± –∫–µ—Ç–º–∞–≥–∞–Ω': '2. –ò–ò–ë —Ö–æ–¥–∏–º–∏ —à–∏—Ñ–æ—Ö–æ–Ω–∞–¥–∞–Ω –º–∞—ä–ª—É–º–æ—Ç–Ω–æ–º–∞ –æ–ª–∏–± –∫–µ—Ç–º–∞–≥–∞–Ω / –º–∞—ä–ª—É–º–æ—Ç –æ–ª–∏–± –∫–µ—Ç–º–∞–≥–∞–Ω.',
    '2. –§—É“õ–∞—Ä–æ –≤–∞ —à–∏—Ñ–æ—Ö–æ–Ω–∞–¥–∞–Ω –º–∞—ä–ª—É–º–æ—Ç –æ–ª–∏–± –±—û–ª–º–∞–¥–∏.': '2. –§—É“õ–∞—Ä–æ –≤–∞ —à–∏—Ñ–æ—Ö–æ–Ω–∞–¥–∞–Ω –º–∞—ä–ª—É–º–æ—Ç –æ–ª–∏–± –±—û–ª–º–∞–¥–∏.',
    '2. –•–æ–¥–∏–º –∞—Ä–∏–∑–∞–Ω–∏ —û—Ä–≥–∞–Ω–∏—à–¥–∞–Ω –±–æ—à —Ç–æ—Ä—Ç–≥–∞–Ω': '2. –•–æ–¥–∏–º –∞—Ä–∏–∑–∞–Ω–∏ —û—Ä–≥–∞–Ω–∏—à–¥–∞–Ω –±–æ—à —Ç–æ—Ä—Ç–≥–∞–Ω.',
    '2. –ë–µ—Ä–∏–ª–≥–∞–Ω —Ç–µ–ª–µ—Ñ–æ–Ω —Ä–∞“õ–∞–º–∏ –±–µ–≥–æ–Ω–∞ –∏–Ω—Å–æ–Ω–≥–∞ —Ç–µ–≥–∏—à–ª–∏, –º–∞—ä–ª—É–º–æ—Ç –æ–ª–∏—à–Ω–∏–Ω–≥ –∏–º–∫–æ–Ω–∏ –±—û–ª–º–∞–¥–∏.': '2. –ë–µ—Ä–∏–ª–≥–∞–Ω —Ç–µ–ª–µ—Ñ–æ–Ω —Ä–∞“õ–∞–º–∏ –±–µ–≥–æ–Ω–∞ –∏–Ω—Å–æ–Ω–≥–∞ —Ç–µ–≥–∏—à–ª–∏, –º–∞—ä–ª—É–º–æ—Ç –æ–ª–∏—à–Ω–∏–Ω–≥ –∏–º–∫–æ–Ω–∏ –±—û–ª–º–∞–¥–∏.',
    '2. –ò—á–∫–∏ –∏—à–ª–∞—Ä “≥–æ–¥–∏–º–∏ –∫–µ—á –∫–µ–ª–≥–∞–Ω.': '2. –ò—á–∫–∏ –∏—à–ª–∞—Ä —Ö–æ–¥–∏–º–∏ –∫–µ—á –∫–µ–ª–≥–∞–Ω.',
    '2. –°–≤–µ—Ç–æ—Ñ–æ—Ä –≤–∞ —Ç–∏—Ä–±–∞–Ω–¥–ª–∏–∫ –±—û–π–∏—á–∞ “≥–µ—á –∫–∏–º –±–æ“ì–ª–∞–Ω–º–∞–≥–∞–Ω, —á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω.': '2. –°–≤–µ—Ç–æ—Ñ–æ—Ä –≤–∞ —Ç–∏—Ä–±–∞–Ω–¥–ª–∏–∫ –±—û–π–∏—á–∞ “≥–µ—á –∫–∏–º –±–æ“ì–ª–∞–Ω–º–∞–≥–∞–Ω, —á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω.',
    '2. –•–æ–¥–∏–º —à–∏—Ñ–æ“≥–æ–Ω–∞–¥–∞–Ω –º–∞—ä–ª—É–º–æ—Ç–Ω–æ–º–∞ –æ–ª–∏–± –∫–µ—Ç–≥–∞–Ω.': '2. –•–æ–¥–∏–º —à–∏—Ñ–æ—Ö–æ–Ω–∞–¥–∞–Ω –º–∞—ä–ª—É–º–æ—Ç–Ω–æ–º–∞ –æ–ª–∏–± –∫–µ—Ç–≥–∞–Ω.',
    
    # –°–ª—É–∂–±–∞ 103
    '3. –¢–µ–∑ —ë—Ä–¥–∞–º –∫–µ–ª–º–∞–≥–∞–Ω.': '3. –¢–µ–∑ —ë—Ä–¥–∞–º –∫–µ–ª–º–∞–≥–∞–Ω.',
    '3. –¢–µ–∑ —ë—Ä–¥–∞–º –∫–µ—á –∫–µ–ª–≥–∞–Ω, —Ñ—É“õ–∞—Ä–æ–Ω–∏–Ω–≥ —û–∑–∏ —à–∏—Ñ–æ—Ö–æ–Ω–∞–≥–∞ –æ–ª–∏–± –∫–µ—Ç–≥–∞–Ω.': '3. –¢–µ–∑ —ë—Ä–¥–∞–º –∫–µ—á –∫–µ–ª–≥–∞–Ω, —Ñ—É“õ–∞—Ä–æ–Ω–∏–Ω–≥ —û–∑–∏ —à–∏—Ñ–æ—Ö–æ–Ω–∞–≥–∞ –æ–ª–∏–± –∫–µ—Ç–≥–∞–Ω.',
    '3. 1 —Å–æ–∞—Ç–≥–∞—á–∞ –∫–µ—á–∏–∫–∏–± –∫–µ–ª–≥–∞–Ω.': '3. 1 —Å–æ–∞—Ç–≥–∞—á–∞ –∫–µ—á–∏–∫–∏–± –∫–µ–ª–≥–∞–Ω.',
    '3. 1 —Å–æ–∞—Ç–¥–∞–Ω 5 —Å–æ–∞—Ç–≥–∞—á–∞ –∫–µ—á –∫–µ–ª–≥–∞–Ω': '3. 1 —Å–æ–∞—Ç–¥–∞–Ω 5 —Å–æ–∞—Ç–≥–∞—á–∞ –∫–µ—á –∫–µ–ª–≥–∞–Ω.',
    '3. 1-—ë—Ä–¥–∞–º —É—á—É–Ω –∫–µ—Ä–∞–∫–ª–∏ –¥–æ—Ä–∏-–¥–∞—Ä–º–æ–Ω–ª–∞—Ä—Å–∏–∑ –∫–µ–ª–≥–∞–Ω': '3. –ë–∏—Ä–∏–Ω—á–∏ —ë—Ä–¥–∞–º —É—á—É–Ω –∫–µ—Ä–∞–∫–ª–∏ –¥–æ—Ä–∏-–¥–∞—Ä–º–æ–Ω–ª–∞—Ä—Å–∏–∑ –∫–µ–ª–≥–∞–Ω.',
    '3. 103 —Ö–æ–¥–∏–º–∏ “õ—û–ø–æ–ª –º—É–æ–º–∞–ª–∞–¥–∞ –±—û–ª–≥–∞–Ω.': '3. 103 —Ö–æ–¥–∏–º–∏ “õ—û–ø–æ–ª –º—É–æ–º–∞–ª–∞–¥–∞ –±—û–ª–≥–∞–Ω.',
    '3. –Å–ª“ì–æ–Ω —á–∞“õ–∏—Ä—É–≤': '3. –Å–ª“ì–æ–Ω —á–∞“õ–∏—Ä—É–≤.',
    '3. –ë–µ–º–æ—Ä–Ω–∏ —à–∏—Ñ–æ—Ö–æ–Ω–∞–≥–∞ –æ–ª–∏–± –±–æ—Ä–∏—à–¥–∞–Ω –±–æ—à —Ç–æ—Ä—Ç–≥–∞–Ω': '3. –ë–µ–º–æ—Ä–Ω–∏ —à–∏—Ñ–æ—Ö–æ–Ω–∞–≥–∞ –æ–ª–∏–± –±–æ—Ä–∏—à–¥–∞–Ω –±–æ—à —Ç–æ—Ä—Ç–≥–∞–Ω.',
    '3. –¢–µ–∑ —ë—Ä–¥–∞–º “≥–æ–¥–∏–º–∏ “≥–µ—á “õ–∞–Ω–¥–∞–π –º—É–æ–ª–∞–∂–∞ “õ–∏–ª–º–∞–π –∫–µ—Ç–≥–∞–Ω–∏–¥–∞–Ω –Ω–æ—Ä–æ–∑–∏': '3. –¢–µ–∑ —ë—Ä–¥–∞–º —Ö–æ–¥–∏–º–∏ “≥–µ—á “õ–∞–Ω–¥–∞–π –º—É–æ–ª–∞–∂–∞ “õ–∏–ª–º–∞–π –∫–µ—Ç–≥–∞–Ω–∏–¥–∞–Ω –Ω–æ—Ä–æ–∑–∏.',
    '3. –¢–µ–∑ —ë—Ä–¥–∞–º —Ö–æ–¥–∏–º–∏ –º–∞–ª–∞–∫–∞—Å–∏–∑–ª–∏–≥–∏–¥–∞–Ω –Ω–æ—Ä–æ–∑–∏': '3. –¢–µ–∑ —ë—Ä–¥–∞–º —Ö–æ–¥–∏–º–∏ –º–∞–ª–∞–∫–∞—Å–∏–∑–ª–∏–≥–∏–¥–∞–Ω –Ω–æ—Ä–æ–∑–∏.',
    
    # –°–ª—É–∂–±–∞ 104
    '4.  “≤–µ—á –∫–∏–º –±–æ“ì–ª–∞–Ω–º–∞–≥–∞–Ω, –∫–µ–ª–º–∞–≥–∞–Ω, —á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω': '4. “≤–µ—á –∫–∏–º –±–æ“ì–ª–∞–Ω–º–∞–≥–∞–Ω, –∫–µ–ª–º–∞–≥–∞–Ω, —á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω.',
    '4.  –ë–æ“ì–ª–∞–Ω–∏—à–≥–∞–Ω, –ª–µ–∫–∏–Ω —á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω': '4. –ë–æ“ì–ª–∞–Ω–≥–∞–Ω, –ª–µ–∫–∏–Ω —á–æ—Ä–∞ –∫—û—Ä–∏–ª–º–∞–≥–∞–Ω.',
    '4.  –•–æ–¥–∏–º–ª–∞—Ä –∫–µ–ª–∏–± –∫–µ—Ç–∏—à–≥–∞–Ω, –ª–µ–∫–∏–Ω —ë—Ä–¥–∞–º –±–µ—Ä–∏—à–º–∞–≥–∞–Ω': '4. –•–æ–¥–∏–º–ª–∞—Ä –∫–µ–ª–∏–± –∫–µ—Ç–≥–∞–Ω, –ª–µ–∫–∏–Ω —ë—Ä–¥–∞–º –±–µ—Ä–º–∞–≥–∞–Ω.',
    '4.  “≤–µ—á –∫–∏–º –±–æ“ì–ª–∞–Ω–º–∞–≥–∞–Ω, –∫–µ–ª–º–∞–≥–∞–Ω, –ª–µ–∫–∏–Ω –≥–∞–∑ –±–æ—Å–∏–º–∏ –∫—û—Ç–∞—Ä–∏–ª–≥–∞–Ω.': '4. “≤–µ—á –∫–∏–º –±–æ“ì–ª–∞–Ω–º–∞–≥–∞–Ω, –∫–µ–ª–º–∞–≥–∞–Ω, –ª–µ–∫–∏–Ω –≥–∞–∑ –±–æ—Å–∏–º–∏ –∫—û—Ç–∞—Ä–∏–ª–≥–∞–Ω.',
    '4.  “≤–µ—á –∫–∏–º –±–æ“ì–ª–∞–Ω–º–∞–≥–∞–Ω, –∫–µ–ª–º–∞–≥–∞–Ω, –ª–µ–∫–∏–Ω –≥–∞–∑ –±–µ—Ä–∏–ª–≥–∞–Ω.': '4. “≤–µ—á –∫–∏–º –±–æ“ì–ª–∞–Ω–º–∞–≥–∞–Ω, –∫–µ–ª–º–∞–≥–∞–Ω, –ª–µ–∫–∏–Ω –≥–∞–∑ –±–µ—Ä–∏–ª–≥–∞–Ω.',
}

def fix_complaints_in_csv():
    """–ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∞–ª–æ–±—ã –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–º CSV —Ñ–∞–π–ª–µ"""
    
    # –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ñ–∞–π–ª
    data_dir = Path('data')
    csv_files = list(data_dir.glob('–ö–û–ù–°–û–õ–ò–î–ò–†–û–í–ê–ù–ù–´–ï_–î–ê–ù–ù–´–ï_*.csv'))
    if not csv_files:
        print("‚ùå CSV —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
        return
    
    latest_file = max(csv_files, key=lambda p: p.stat().st_ctime)
    print(f"üìÑ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é —Ñ–∞–π–ª: {latest_file.name}")
    
    # –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª
    df = pd.read_csv(latest_file, low_memory=False)
    original_count = len(df)
    
    # –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    if '–ö–æ–ª–æ–Ω–∫–∞_7' in df.columns:
        corrections_made = 0
        for old_text, new_text in CORRECTIONS.items():
            mask = df['–ö–æ–ª–æ–Ω–∫–∞_7'] == old_text
            count = mask.sum()
            if count > 0:
                df.loc[mask, '–ö–æ–ª–æ–Ω–∫–∞_7'] = new_text
                corrections_made += count
                print(f"  ‚úì –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ '{old_text[:50]}...' -> '{new_text[:50]}...' ({count} —Ä–∞–∑)")
        
        print(f"\n‚úÖ –í—Å–µ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π: {corrections_made}")
    else:
        print("‚ùå –ö–æ–ª–æ–Ω–∫–∞ '–ö–æ–ª–æ–Ω–∫–∞_7' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        return
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º
    output_file = data_dir / f'–ö–û–ù–°–û–õ–ò–î–ò–†–û–í–ê–ù–ù–´–ï_–î–ê–ù–ù–´–ï_–ò–°–ü–†–ê–í–õ–ï–ù–û_{pd.Timestamp.now().strftime("%Y%m%d_%H%M%S")}.csv'
    df.to_csv(output_file, index=False, encoding='utf-8-sig')
    
    print(f"\nüíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {output_file.name}")
    print(f"   –ó–∞–ø–∏—Å–µ–π: {len(df):,}")

if __name__ == '__main__':
    fix_complaints_in_csv()
