"""
–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–¥–∞ Google Apps Script –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤ –∫ –∫–æ–ª–æ–Ω–∫–µ E
–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –≤—Å—Ç–∞–≤–∏—Ç—å
–≤ Google Apps Script —Ä–µ–¥–∞–∫—Ç–æ—Ä.
"""

# –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ (RGB –≤ —Ñ–æ—Ä–º–∞—Ç–µ 0-1)
STATUS_COLORS = {
    "–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π": {"bg": "#ff6666", "fg": "#000000"},          # –°–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π
    "–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π": {"bg": "#99ff99", "fg": "#000000"},          # –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π  
    "—Ç–∏—à–∏–Ω–µ": {"bg": "#ffd9d9", "fg": "#000000"},                 # –ù–µ–∂–Ω–æ-—Ä–æ–∑–æ–≤—ã–π
    "—Å–æ–µ–¥ –ø—Ä–µ—Ä–≤–∞–Ω–æ": {"bg": "#ffd9d9", "fg": "#000000"},          # –ù–µ–∂–Ω–æ-—Ä–æ–∑–æ–≤—ã–π
    "–ù–ï–¢ –û–¢–í–ï–¢–ê (–ó–ê–ù–Ø–¢–û)": {"bg": "#ffff99", "fg": "#000000"},   # –°–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π
    "–∑–∞—è–≤–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞ (–Ω–µ —É–¥–∞–ª–æ—Å—å –¥–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è)": {"bg": "#d9d9d9", "fg": "#000000"},  # –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π
    "–æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É": {"bg": "#99d9ff", "fg": "#000000"},          # –°–≤–µ—Ç–ª–æ-–Ω–µ–±–µ—Å–Ω—ã–π
    "—Ç–∏–±–±–∏—ë—Ç —Ö–æ–¥–∏–º–∏ –∞—Ä–∏–∑–∞—Å–∏": {"bg": "#b3e6ff", "fg": "#000000"}  # –ù–µ–∂–Ω–æ-–≥–æ–ª—É–±–æ–π
}

def generate_apps_script():
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Google Apps Script –∫–æ–¥"""
    
    code = '''/**
 * –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç–æ–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ –∫–æ–ª–æ–Ω–∫–µ E (–°—Ç–∞—Ç—É—Å—ã)
 * –í–µ—Ä—Å–∏—è: 3.2 (—Å–≤–µ—Ç–ª–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è –≥–∞–º–º–∞)
 * 
 * –¶–í–ï–¢–ê:
 * ‚Ä¢ –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π ‚Üí –°–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π
 * ‚Ä¢ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π ‚Üí –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π
 * ‚Ä¢ –¢–∏—à–∏–Ω–µ ‚Üí –ù–µ–∂–Ω–æ-—Ä–æ–∑–æ–≤—ã–π
 * ‚Ä¢ –°–æ–µ–¥ –ø—Ä–µ—Ä–≤–∞–Ω–æ ‚Üí –ù–µ–∂–Ω–æ-—Ä–æ–∑–æ–≤—ã–π
 * ‚Ä¢ –ù–ï–¢ –û–¢–í–ï–¢–ê (–ó–ê–ù–Ø–¢–û) ‚Üí –°–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π
 * ‚Ä¢ –ó–∞—è–≤–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞ ‚Üí –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π
 * ‚Ä¢ –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É ‚Üí –°–≤–µ—Ç–ª–æ-–Ω–µ–±–µ—Å–Ω—ã–π
 * ‚Ä¢ –¢–∏–±–±–∏—ë—Ç —Ö–æ–¥–∏–º–∏ –∞—Ä–∏–∑–∞—Å–∏ ‚Üí –ù–µ–∂–Ω–æ-–≥–æ–ª—É–±–æ–π
 */
function applyStatusColorFormatting() {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheet = ss.getSheetByName("FIKSA");
  
  if (!sheet) {
    Logger.log("–õ–∏—Å—Ç FIKSA –Ω–µ –Ω–∞–π–¥–µ–Ω");
    SpreadsheetApp.getUi().alert("–õ–∏—Å—Ç FIKSA –Ω–µ –Ω–∞–π–¥–µ–Ω!");
    return;
  }
  
  var lastRow = sheet.getMaxRows();
  if (lastRow < 1000) lastRow = 1000;
  
  // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —É—Å–ª–æ–≤–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ E
  var rules = sheet.getConditionalFormatRules();
  var newRules = [];
  
  for (var i = 0; i < rules.length; i++) {
    var ranges = rules[i].getRanges();
    var keepRule = true;
    
    for (var j = 0; j < ranges.length; j++) {
      if (ranges[j].getColumn() === 5) {
        keepRule = false;
        break;
      }
    }
    
    if (keepRule) {
      newRules.push(rules[i]);
    }
  }
  
  var range = sheet.getRange("E2:E" + lastRow);
  
  // –°–æ–∑–¥–∞–µ–º –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
'''
    
    for status, colors in STATUS_COLORS.items():
        code += f'''
  // {status}
  var rule = SpreadsheetApp.newConditionalFormatRule()
    .whenTextEqualTo("{status}")
    .setBackground("{colors["bg"]}")
    .setFontColor("{colors["fg"]}")
    .setRanges([range])
    .build();
  newRules.push(rule);
'''
    
    code += '''
  // –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞
  sheet.setConditionalFormatRules(newRules);
  
  Logger.log("‚úì –¶–≤–µ—Ç–æ–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ –∫ –∫–æ–ª–æ–Ω–∫–µ E");
  SpreadsheetApp.getUi().alert(
    "‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ!\\n\\n" +
    "–ö–æ–ª–æ–Ω–∫–∞ E —Ç–µ–ø–µ—Ä—å —Å —Ü–≤–µ—Ç–Ω–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤.\\n\\n" +
    "–í—Å–µ–≥–æ –ø—Ä–∞–≤–∏–ª: " + newRules.length
  );
}

/**
 * –°–æ–∑–¥–∞–µ—Ç –º–µ–Ω—é –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
 */
function onOpen() {
  var ui = SpreadsheetApp.getUi();
  ui.createMenu("üé® –¶–≤–µ—Ç–∞")
    .addItem("–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç–∞ –∫ —Å—Ç–∞—Ç—É—Å–∞–º", "applyStatusColorFormatting")
    .addToUi();
}
'''
    
    return code

def save_to_file(code):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–¥ –≤ —Ñ–∞–π–ª"""
    filename = "apply_colors_script.gs"
    
    with open(filename, 'w', encoding='utf-8') as f:
        f.write(code)
    
    print(f"‚úÖ –ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Ñ–∞–π–ª: {filename}")
    print()
    print("=" * 70)
    print("üìã –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ü–†–ò–ú–ï–ù–ï–ù–ò–Æ:")
    print("=" * 70)
    print()
    print("1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à—É —Ç–∞–±–ª–∏—Ü—É –≤ Google Sheets")
    print("2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: –†–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Üí Apps Script")
    print("3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π")
    print("4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞ 'apply_colors_script.gs'")
    print("5. –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä Apps Script")
    print("6. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ (Ctrl+S)")
    print("7. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É")
    print("8. –í –º–µ–Ω—é –ø–æ—è–≤–∏—Ç—Å—è 'üé® –¶–≤–µ—Ç–∞' ‚Üí '–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç–∞ –∫ —Å—Ç–∞—Ç—É—Å–∞–º'")
    print("9. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é")
    print()
    print("=" * 70)
    print("üé® –¶–í–ï–¢–û–í–ê–Ø –°–•–ï–ú–ê (—Å–≤–µ—Ç–ª–∞—è –≥–∞–º–º–∞):")
    print("=" * 70)
    for status, colors in STATUS_COLORS.items():
        print(f"   ‚Ä¢ {status:40s} ‚Üí {colors['bg']}")
    print("=" * 70)

def main():
    print("=" * 70)
    print("üé® –ì–ï–ù–ï–†–ê–¢–û–† –ö–û–î–ê –î–õ–Ø –¶–í–ï–¢–û–í–û–ì–û –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø")
    print("=" * 70)
    print()
    
    code = generate_apps_script()
    save_to_file(code)
    
    print()
    print("‚ú® –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –∫–æ–¥ –≤ Google Apps Script.")

if __name__ == '__main__':
    main()
