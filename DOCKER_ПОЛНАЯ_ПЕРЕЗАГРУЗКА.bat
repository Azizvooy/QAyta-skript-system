@echo off
chcp 65001 >nul
cls
echo.
echo ================================================================================
echo üîÑ –ü–û–õ–ù–ê–Ø –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ê DOCKER DESKTOP
echo ================================================================================
echo.

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
net session >nul 2>&1
if %errorLevel% neq 0 (
    echo –ó–∞–ø—É—Å–∫–∞—é —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞...
    powershell -Command "Start-Process '%~f0' -Verb RunAs"
    exit /b
)

cd /d "%~dp0"

echo –®–ê–ì 1: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker...
echo.
call DOCKER_–ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø_–û–°–¢–ê–ù–û–í–ö–ê.bat

echo.
echo ================================================================================
echo –®–ê–ì 2: –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ Docker
echo ================================================================================
echo.

echo –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ Docker...
rd /s /q "%LOCALAPPDATA%\Docker\wsl\data" 2>nul
rd /s /q "%APPDATA%\Docker" 2>nul
timeout /t 2 /nobreak >nul
echo ‚úÖ –ì–æ—Ç–æ–≤–æ

echo.
echo ================================================================================
echo –®–ê–ì 3: –ó–∞–ø—É—Å–∫ Docker Desktop
echo ================================================================================
echo.

if exist "C:\Program Files\Docker\Docker\Docker Desktop.exe" (
    echo –ó–∞–ø—É—Å–∫–∞—é Docker Desktop...
    start "" "C:\Program Files\Docker\Docker\Docker Desktop.exe"
    
    echo.
    echo ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ Docker Desktop...
    echo    –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã...
    echo.
    
    :wait_docker
    timeout /t 5 /nobreak >nul
    docker info >nul 2>&1
    if %ERRORLEVEL% NEQ 0 (
        echo    –ï—â–µ –æ–∂–∏–¥–∞–µ–º...
        goto :wait_docker
    )
    
    echo.
    echo ‚úÖ Docker Desktop –∑–∞–ø—É—â–µ–Ω!
    echo.
    
    echo ================================================================================
    echo –®–ê–ì 4: –ó–∞–ø—É—Å–∫ PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
    echo ================================================================================
    echo.
    
    echo –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤...
    docker compose up -d
    
    if %ERRORLEVEL% EQU 0 (
        echo.
        echo ================================================================================
        echo ‚úÖ –í–°–ï –£–°–ü–ï–®–ù–û –ó–ê–ü–£–©–ï–ù–û!
        echo ================================================================================
        echo.
        echo PostgreSQL –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: localhost:5432
        echo pgAdmin –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: http://localhost:5050
        echo.
        echo –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:
        echo   –ù–ê–°–¢–†–û–ô–ö–ê_POSTGRESQL.bat
        echo.
    ) else (
        echo.
        echo ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
        echo.
        echo –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
        echo   1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–º–ø—å—é—Ç–µ—Ä
        echo   2. –û–±–Ω–æ–≤–∏—Ç—å WSL: –û–ë–ù–û–í–ò–¢–¨_WSL.bat
        echo.
    )
) else (
    echo ‚ùå Docker Desktop –Ω–µ –Ω–∞–π–¥–µ–Ω!
    echo.
)

pause
