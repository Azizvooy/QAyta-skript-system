@echo off
chcp 65001 >nul
title –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets

echo.
echo ================================================================================
echo üì• –ò–ú–ü–û–†–¢ –î–ê–ù–ù–´–• –ò–ó GOOGLE SHEETS
echo ================================================================================
echo.
echo ‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ù–ê –í–ê–®–ï–ú –ö–û–ú–ü–¨–Æ–¢–ï–†–ï,
echo     –∞ –Ω–µ –≤ GitHub Codespaces (—Ç–∞–º –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–∫—Å–∏)
echo.
echo üìã –ß—Ç–æ –±—É–¥–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ:
echo    ‚Ä¢ 35 Google Sheets –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
echo    ‚Ä¢ 20 –ª–∏—Å—Ç–æ–≤ –≤ –∫–∞–∂–¥–æ–º (FIKSA + 19 –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤)
echo    ‚Ä¢ –ö–æ–ª–æ–Ω–∫–∏ 2-12 (–∫–∞—Ä—Ç–∞, —Ç–µ–ª–µ—Ñ–æ–Ω, –¥–∞—Ç–∞, —Ä–µ–≥–∏–æ–Ω, –∂–∞–ª–æ–±–∞, —Å—Ç–∞—Ç—É—Å –∏ —Ç.–¥.)
echo    ‚Ä¢ –¢–û–õ–¨–ö–û –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
echo.
echo ‚è±Ô∏è  –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è: 5-15 –º–∏–Ω—É—Ç
echo.
echo ================================================================================
echo.

pause

echo.
echo [1/3] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...

if not exist "config\credentials.json" (
    echo ‚ùå –§–∞–π–ª config\credentials.json –Ω–µ –Ω–∞–π–¥–µ–Ω!
    echo    –°–∫–∞—á–∞–π—Ç–µ credentials.json –∏–∑ Google Cloud Console –∏ –ø–æ–ª–æ–∂–∏—Ç–µ –≤ –ø–∞–ø–∫—É config\
    pause
    exit /b 1
)

echo ‚úÖ credentials.json –Ω–∞–π–¥–µ–Ω

echo.
echo [2/3] –ó–∞–ø—É—Å–∫ –∏–º–ø–æ—Ä—Ç–∞...
echo.

python import_sheets_consolidated.py

if %ERRORLEVEL% NEQ 0 (
    echo.
    echo ‚ùå –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π!
    echo    –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
    echo    ‚Ä¢ –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ 10.145.62.76:3128
    echo    ‚Ä¢ –ù–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤ credentials.json –∏ token.json –≤ –ø–∞–ø–∫–µ config\
    echo    ‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: pip install -r requirements.txt
    echo.
    pause
    exit /b %ERRORLEVEL%
)

echo.
echo [3/3] –ü–æ–∏—Å–∫ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞...

for /f "delims=" %%f in ('dir /b /o-d data\–ö–û–ù–°–û–õ–ò–î–ò–†–û–í–ê–ù–ù–´–ï_–î–ê–ù–ù–´–ï_*.csv 2^>nul') do (
    set "LATEST_FILE=%%f"
    goto :found
)

:found
if defined LATEST_FILE (
    echo.
    echo ================================================================================
    echo ‚úÖ –ò–ú–ü–û–†–¢ –ó–ê–í–ï–†–®–Å–ù –£–°–ü–ï–®–ù–û!
    echo ================================================================================
    echo.
    echo üìÑ –°–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª: %LATEST_FILE%
    echo üìÅ –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: data\%LATEST_FILE%
    echo.
    echo üì§ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:
    echo    1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –≤ GitHub Codespaces:
    echo       git add data\%LATEST_FILE%
    echo       git commit -m "–î–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets"
    echo       git push
    echo.
    echo    2. –í Codespaces –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
    echo       git pull
    echo.
    echo    3. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–π —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∞–π–ª –≤ Codespaces
    echo.
    echo    4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É:
    echo       python3 process_period_data.py
    echo.
    echo ================================================================================
) else (
    echo.
    echo ‚ö†Ô∏è  –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–∞–ø–∫–µ data\
    echo    –í–æ–∑–º–æ–∂–Ω–æ, –∏–º–ø–æ—Ä—Ç –Ω–µ —Å–æ–∑–¥–∞–ª —Ñ–∞–π–ª –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö.
    echo    –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥ –≤—ã—à–µ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫.
    echo.
)

echo.
pause
