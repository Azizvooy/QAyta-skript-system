import pandas as pd
import os

# –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
file_path = r'c:\Users\a.djurayev\Desktop\QAyta skript\ALL_DATA_CLEANED.csv'

print("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...")
print(f"–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: {os.path.getsize(file_path) / (1024*1024):.2f} –ú–ë")

# –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
df = pd.read_csv(file_path, encoding='utf-8-sig', low_memory=False)

print(f"\n–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –≤ —Ñ–∞–π–ª–µ: {len(df):,}")

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã
print("\n–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç...")
df['–î–∞—Ç–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏'] = pd.to_datetime(df['–î–∞—Ç–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏'], format='%d.%m.%Y %H:%M:%S', errors='coerce')

# –§–∏–ª—å—Ç—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞ 2025 –≥–æ–¥
df_2025 = df[df['–î–∞—Ç–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏'].dt.year == 2025].copy()

print("\n" + "="*80)
print("–°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û 2025 –ì–û–î–£")
print("="*80)

print(f"\nüìÖ –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –∑–∞ 2025 –≥–æ–¥: {len(df_2025):,}")

if len(df_2025) == 0:
    print("\n‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ 2025 –≥–æ–¥!")
    print("\n–ü—Ä–æ–≤–µ—Ä–∏–º –∫–∞–∫–∏–µ –≥–æ–¥—ã –µ—Å—Ç—å –≤ –¥–∞–Ω–Ω—ã—Ö:")
    df['–ì–æ–¥'] = df['–î–∞—Ç–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏'].dt.year
    print(df['–ì–æ–¥'].value_counts().sort_index())
else:
    # –ü–æ–¥—Å—á–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–∞—è–≤–æ–∫ –∑–∞ 2025 –≥–æ–¥
    unique_applications_2025 = df_2025['–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã'].nunique()
    print(f"üìä –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–∞—è–≤–æ–∫ –∑–∞ 2025 –≥–æ–¥: {unique_applications_2025:,}")
    
    # –ê–Ω–∞–ª–∏–∑ –ø–æ –º–µ—Å—è—Ü–∞–º
    print("\n--- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º 2025 –≥–æ–¥–∞ ---")
    df_2025['–ú–µ—Å—è—Ü_—á–∏—Å–ª–æ'] = df_2025['–î–∞—Ç–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏'].dt.month
    months_dict = {1: '–Ø–Ω–≤–∞—Ä—å', 2: '–§–µ–≤—Ä–∞–ª—å', 3: '–ú–∞—Ä—Ç', 4: '–ê–ø—Ä–µ–ª—å', 5: '–ú–∞–π', 6: '–ò—é–Ω—å',
                   7: '–ò—é–ª—å', 8: '–ê–≤–≥—É—Å—Ç', 9: '–°–µ–Ω—Ç—è–±—Ä—å', 10: '–û–∫—Ç—è–±—Ä—å', 11: '–ù–æ—è–±—Ä—å', 12: '–î–µ–∫–∞–±—Ä—å'}
    
    monthly_stats = df_2025.groupby('–ú–µ—Å—è—Ü_—á–∏—Å–ª–æ').agg({
        '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã': 'count',
        '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã': lambda x: x.nunique()
    })
    
    for month_num in sorted(df_2025['–ú–µ—Å—è—Ü_—á–∏—Å–ª–æ'].unique()):
        month_data = df_2025[df_2025['–ú–µ—Å—è—Ü_—á–∏—Å–ª–æ'] == month_num]
        calls = len(month_data)
        unique = month_data['–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã'].nunique()
        print(f"{months_dict.get(month_num, month_num)}: {calls:,} –∑–≤–æ–Ω–∫–æ–≤, {unique:,} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–∞—è–≤–æ–∫")
    
    # –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞ 2025 –≥–æ–¥
    print("\n--- –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞ 2025 –≥–æ–¥ ---")
    status_counts = df_2025['–°—Ç–∞—Ç—É—Å'].value_counts()
    print(status_counts.head(20))
    
    # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    print("\n" + "="*80)
    print("–î–ï–¢–ê–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –ó–ê 2025 –ì–û–î")
    print("="*80)
    
    positive = df_2025[df_2025['–°—Ç–∞—Ç—É—Å'].str.lower().str.contains('–ø–æ–ª–æ–∂–∏—Ç', na=False)]
    negative = df_2025[df_2025['–°—Ç–∞—Ç—É—Å'].str.lower().str.contains('–æ—Ç—Ä–∏—Ü–∞—Ç', na=False)]
    no_answer = df_2025[df_2025['–°—Ç–∞—Ç—É—Å'].str.lower().str.contains('–Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞|–∑–∞–Ω—è—Ç–æ', na=False)]
    closed = df_2025[df_2025['–°—Ç–∞—Ç—É—Å'].str.lower().str.contains('–∑–∞–∫—Ä—ã—Ç–∞', na=False)]
    disconnected = df_2025[df_2025['–°—Ç–∞—Ç—É—Å'].str.lower().str.contains('—Å–æ–µ–¥.–ø—Ä–µ—Ä–≤–∞–Ω–æ|–ø—Ä–µ—Ä–≤–∞–Ω–æ', na=False)]
    silence = df_2025[df_2025['–°—Ç–∞—Ç—É—Å'].str.lower().str.contains('—Ç–∏—à–∏–Ω–∞', na=False)]
    medical = df_2025[df_2025['–°—Ç–∞—Ç—É—Å'].str.lower().str.contains('—Ç–∏–±–±–∏—ë—Ç|—Ö–æ–¥–∏–º–∏', na=False)]
    
    print(f"\n‚úÖ –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–´–ï –û–¢–í–ï–¢–´: {len(positive):,} ({len(positive)/len(df_2025)*100:.2f}%)")
    print(f"   –ö–ª–∏–µ–Ω—Ç—ã —Å–æ–≥–ª–∞—Å–∏–ª–∏—Å—å –Ω–∞ –∫–∞—Ä—Ç—É")
    
    print(f"\n‚ùå –û–¢–†–ò–¶–ê–¢–ï–õ–¨–ù–´–ï –û–¢–í–ï–¢–´: {len(negative):,} ({len(negative)/len(df_2025)*100:.2f}%)")
    print(f"   –ö–ª–∏–µ–Ω—Ç—ã –æ—Ç–∫–∞–∑–∞–ª–∏—Å—å –æ—Ç –∫–∞—Ä—Ç—ã")
    
    print(f"\nüìû –ù–ï–î–û–ó–í–û–ù–´ (–ù–ï–¢ –û–¢–í–ï–¢–ê/–ó–ê–ù–Ø–¢–û): {len(no_answer):,} ({len(no_answer)/len(df_2025)*100:.2f}%)")
    print(f"   –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è –¥–æ –∫–ª–∏–µ–Ω—Ç–∞")
    
    print(f"\nüö´ –ó–ê–Ø–í–ö–ê –ó–ê–ö–†–´–¢–ê: {len(closed):,} ({len(closed)/len(df_2025)*100:.2f}%)")
    print(f"   –ó–∞—è–≤–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã –ø–æ—Å–ª–µ –±–µ–∑—É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫")
    
    print(f"\nüìµ –°–û–ï–î–ò–ù–ï–ù–ò–ï –ü–†–ï–†–í–ê–ù–û: {len(disconnected):,} ({len(disconnected)/len(df_2025)*100:.2f}%)")
    print(f"   –ó–≤–æ–Ω–æ–∫ –ø—Ä–µ—Ä–≤–∞–ª—Å—è –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞")
    
    print(f"\nüîá –¢–ò–®–ò–ù–ê: {len(silence):,} ({len(silence)/len(df_2025)*100:.2f}%)")
    print(f"   –ö–ª–∏–µ–Ω—Ç –ø–æ–¥–Ω—è–ª —Ç—Ä—É–±–∫—É, –Ω–æ –º–æ–ª—á–∏—Ç")
    
    print(f"\nüè• –ú–ï–î–†–ê–ë–û–¢–ù–ò–ö–ò: {len(medical):,} ({len(medical)/len(df_2025)*100:.2f}%)")
    print(f"   –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∑–∞—è–≤–∫–∏ –º–µ–¥—Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤")
    
    # –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞
    print("\n" + "-"*80)
    print("–ò–¢–û–ì–û–í–ê–Ø –°–í–û–î–ö–ê:")
    print("-"*80)
    total_reached = len(positive) + len(negative)
    total_not_reached = len(no_answer) + len(closed) + len(disconnected) + len(silence)
    
    print(f"üìä –î–æ–∑–≤–æ–Ω–∏–ª–∏—Å—å –∏ –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç–≤–µ—Ç: {total_reached:,} ({total_reached/len(df_2025)*100:.2f}%)")
    print(f"   ‚úÖ –ò–∑ –Ω–∏—Ö –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö: {len(positive):,} ({len(positive)/total_reached*100:.2f}% –æ—Ç –¥–æ–∑–≤–æ–Ω–∏–≤—à–∏—Ö—Å—è)")
    print(f"   ‚ùå –ò–∑ –Ω–∏—Ö –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö: {len(negative):,} ({len(negative)/total_reached*100:.2f}% –æ—Ç –¥–æ–∑–≤–æ–Ω–∏–≤—à–∏—Ö—Å—è)")
    
    print(f"\nüìµ –ù–ï –¥–æ–∑–≤–æ–Ω–∏–ª–∏—Å—å: {total_not_reached:,} ({total_not_reached/len(df_2025)*100:.2f}%)")
    print(f"   üìû –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞/–ó–∞–Ω—è—Ç–æ: {len(no_answer):,}")
    print(f"   üö´ –ó–∞—è–≤–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞: {len(closed):,}")
    print(f"   üìµ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ: {len(disconnected):,}")
    print(f"   üîá –¢–∏—à–∏–Ω–∞: {len(silence):,}")
    
    # –¢–æ–ø –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∑–∞ 2025 –≥–æ–¥
    print("\n--- –¢–æ–ø 10 –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–≤–æ–Ω–∫–æ–≤ –∑–∞ 2025 –≥–æ–¥ ---")
    top_operators = df_2025['–û–ø–µ—Ä–∞—Ç–æ—Ä'].value_counts().head(10)
    for i, (operator, count) in enumerate(top_operators.items(), 1):
        print(f"{i}. {operator}: {count:,} –∑–≤–æ–Ω–∫–æ–≤")
    
    # –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–¥–æ–ª—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞ –¥–æ–∑–≤–æ–Ω–∏–≤—à–∏—Ö—Å—è)
    answered = len(df_2025) - len(no_answer) - len(closed)
    if answered > 0:
        efficiency = len(positive) / answered * 100
        print(f"\nüìà –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç –¥–æ–∑–≤–æ–Ω–∏–≤—à–∏—Ö—Å—è): {efficiency:.2f}%")
        print(f"   (–∏–∑ {answered:,} –¥–æ–∑–≤–æ–Ω–∏–≤—à–∏—Ö—Å—è, {len(positive):,} –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö)")
