#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
=================================================================
–ò–ú–ü–û–†–¢ –î–ê–ù–ù–´–• –ò–ó GOOGLE SHEETS –í POSTGRESQL
=================================================================
–°–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å–æ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ 112 –∏–∑ Google Sheets.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –ª–∏—Å—Ç—ã –∏–∑ –≤—Å–µ—Ö 35 –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω (A:Z –≤–º–µ—Å—Ç–æ A1:Z10000)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω—ã –∏ –æ—á–∏—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü—É action_history

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
    python scripts/import/import_from_sheets.py

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: config/postgresql.env, config/google_api.env
=================================================================
"""

import os
import sys
from pathlib import Path
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
CONFIG_DIR = Path(__file__).parent.parent.parent / 'config'
load_dotenv(CONFIG_DIR / 'postgresql.env')
load_dotenv(CONFIG_DIR / 'google_api.env')

print("üìã –ò–ú–ü–û–†–¢ –î–ê–ù–ù–´–• –ò–ó GOOGLE SHEETS")
print("="*70)
print("‚úì –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
print(f"‚úì –ë–î: {os.getenv('DB_NAME', 'qayta_data')}")
print(f"‚úì –•–æ—Å—Ç: {os.getenv('DB_HOST', 'localhost')}:{os.getenv('DB_PORT', '5432')}")
print("\nüìä –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–º–ø–æ—Ä—Ç–∞...\n")

# –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∞
try:
    # –ü—ã—Ç–∞–µ–º—Å—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
    sys.path.insert(0, str(Path(__file__).parent.parent.parent / 'scripts' / 'database'))
    
    from import_all_sheets_filtered import main as import_main
    
    import_main()
    print("\n‚úÖ –ò–ú–ü–û–†–¢ –ó–ê–í–ï–†–®–ï–ù\n")
    
except Exception as e:
    print(f"\n‚ö†Ô∏è  –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –∏–º–ø–æ—Ä—Ç–∞")
    print(f"–û—à–∏–±–∫–∞: {e}\n")
    
    # –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –≤—ã–≤–æ–¥–∏–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
    print("""
    –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–º–∞–Ω–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:
    
    1. –ò–ú–ü–û–†–¢_–ò–ó_GOOGLE_SHEETS.bat - –±–∞–∑–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç
    2. –ò–ú–ü–û–†–¢_–ò_–û–ë–†–ê–ë–û–¢–ö–ê_–í_–ë–î.bat - –∏–º–ø–æ—Ä—Ç + –æ–±—Ä–∞–±–æ—Ç–∫–∞
    
    –ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:
    python scripts/database/import_all_sheets_filtered.py
    """)
    sys.exit(1)
