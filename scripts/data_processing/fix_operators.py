"""
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ - –±–µ—Ä–µ–º –∏–∑ –∫–æ–ª–æ–Ω–∫–∏ "–û–ø–µ—Ä–∞—Ç–æ—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–≤—à–∏–π"
"""
import pandas as pd

print("=" * 80)
print("–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–£–°–¢–´–• –û–ü–ï–†–ê–¢–û–†–û–í")
print("=" * 80)

# –ö–æ–ª–æ–Ω–∫–∏
COLUMNS = [
    '–û–ø–µ—Ä–∞—Ç–æ—Ä',
    '–ê—Ä—Ö–∏–≤–Ω—ã–π –ª–∏—Å—Ç',
    '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã',
    '–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞',
    '–î–∞—Ç–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–∞—Ä—Ç—ã',
    '–°—Ç–∞—Ç—É—Å',
    '–°–ª—É–∂–±–∞',
    '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π',
    '–û–ø–µ—Ä–∞—Ç–æ—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–≤—à–∏–π',
    '–î–∞—Ç–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏'
]

# –ó–∞–≥—Ä—É–∑–∫–∞
print("\nüìñ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...")
df = pd.read_csv('ALL_DATA.csv', encoding='utf-8-sig', names=COLUMNS, skiprows=1)
print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ: {len(df):,} —Å—Ç—Ä–æ–∫")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
empty_operators = df['–û–ø–µ—Ä–∞—Ç–æ—Ä'].isna() | (df['–û–ø–µ—Ä–∞—Ç–æ—Ä'].str.strip() == '')
print(f"\nüîç –ü—É—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤: {empty_operators.sum():,}")

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ: –µ—Å–ª–∏ –û–ø–µ—Ä–∞—Ç–æ—Ä –ø—É—Å—Ç–æ–π, –±–µ—Ä–µ–º –∏–∑ "–û–ø–µ—Ä–∞—Ç–æ—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–≤—à–∏–π"
print("\nüîß –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤...")
df.loc[empty_operators, '–û–ø–µ—Ä–∞—Ç–æ—Ä'] = df.loc[empty_operators, '–û–ø–µ—Ä–∞—Ç–æ—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–≤—à–∏–π']

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
still_empty = df['–û–ø–µ—Ä–∞—Ç–æ—Ä'].isna() | (df['–û–ø–µ—Ä–∞—Ç–æ—Ä'].str.strip() == '')
print(f"‚úÖ –û—Å—Ç–∞–ª–æ—Å—å –ø—É—Å—Ç—ã—Ö: {still_empty.sum():,}")

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö "–û–ø–µ—Ä–∞—Ç–æ—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–≤—à–∏–π" –∏ "–î–∞—Ç–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏" (forward fill)
print("\nüîß –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö '–û–ø–µ—Ä–∞—Ç–æ—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–≤—à–∏–π' –∏ '–î–∞—Ç–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏'...")
df['–û–ø–µ—Ä–∞—Ç–æ—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–≤—à–∏–π'] = df['–û–ø–µ—Ä–∞—Ç–æ—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–≤—à–∏–π'].ffill()
df['–î–∞—Ç–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏'] = df['–î–∞—Ç–∞ —Ñ–∏–∫—Å–∞—Ü–∏–∏'].ffill()

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
print("\nüíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...")
df.to_csv('ALL_DATA_FIXED.csv', index=False, encoding='utf-8-sig')

print(f"\n‚úÖ –ì–û–¢–û–í–û!")
print(f"   –§–∞–π–ª: ALL_DATA_FIXED.csv")
print(f"   –°—Ç—Ä–æ–∫: {len(df):,}")
print(f"   –û–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: {df['–û–ø–µ—Ä–∞—Ç–æ—Ä'].nunique()}")

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º
print(f"\nüìä –¢–û–ü-10 –û–ü–ï–†–ê–¢–û–†–û–í:")
print("=" * 80)
top_operators = df['–û–ø–µ—Ä–∞—Ç–æ—Ä'].value_counts().head(10)
for op, count in top_operators.items():
    print(f"{op:<40} {count:>12,}")

print("\n" + "=" * 80)
