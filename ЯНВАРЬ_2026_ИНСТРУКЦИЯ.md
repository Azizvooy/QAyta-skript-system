# Обработка данных за январь 2026

## Описание

Система для импорта и сопоставления данных из Google Sheets с данными 112 за январь 2026 (файлы из папки `123`).

## Особенности январских файлов

Файлы в папке `123` имеют **19 колонок** на узбекском языке:

| № | Колонка узбекская | Русский перевод | Описание |
|---|------------------|-----------------|----------|
| 8 | Карточка рақами | Номер карточки | Уникальный номер карточки |
| 9 | Ҳодиса рақами | Номер инцидента | Номер инцидента (один инцидент может иметь несколько карточек для разных служб) |
| 6 | Хизмат | Служба | Название службы |
| 10 | Оператор | Оператор | Имя оператора |
| 19 | Мурожаатчи телефон рақами | Телефон заявителя | Номер телефона |

## Логика сопоставления

### 1. Импорт из Google Sheets
- Импортируются **только полностью заполненные строки** (все колонки 2-12 должны быть заполнены)
- Листы: `FIKSA` и `{ФИО} 01.2026` для каждого оператора
- Всего **35 документов** проверяется

### 2. Сопоставление с данными 112
- **Приоритет**: сопоставление по **номеру карточки** (Карточка рақами)
- Также учитывается **номер инцидента** (Ҳодиса рақами) для подсчёта количества служб

### 3. Применение логики

#### Если есть жалоба:
- Оставляем данные как есть
- Тип: `Жалоба - по номеру карты`

#### Если нет жалобы:
- **Автоматически ставим** `Положительно`
- Если в инциденте **несколько служб**: `Положительно - несколько служб`
- Если в инциденте **одна служба**: `Положительно - одна служба`

### 4. Удаление дубликатов
- Удаляются полные дубликаты строк
- Удаляются дубликаты по ключевым полям: `Инцидент + Карта + Служба`

## Файлы скриптов

### 1. `import_january_data.py`
**Полная версия** с импортом через Google Sheets API
- Импортирует напрямую из Google Sheets
- Требует credentials.json и token.json
- Работает только при наличии интернета и доступа к Google API

### 2. `process_january_simple.py`
**Упрощённая версия** для работы с локальными данными
- Использует уже загруженный файл `data/КОНСОЛИДИРОВАННЫЕ_ДАННЫЕ_*.csv`
- Не требует доступа к Google API
- Быстрее работает

## Быстрый запуск

### Вариант 1: Автоматический (рекомендуется)

Запустите bat-файл:
```batch
ОБРАБОТАТЬ_ЯНВАРЬ_2026.bat
```

Этот файл выполнит:
1. Импорт данных из Google Sheets (`import_sheets_consolidated.py`)
2. Сопоставление с данными 112 (`process_january_simple.py`)

### Вариант 2: Ручной запуск

#### Шаг 1: Импорт из Google Sheets
```bash
python import_sheets_consolidated.py
```

#### Шаг 2: Обработка январских данных
```bash
python process_january_simple.py
```

## Требования

### Структура папок
```
QAyta-skript-system/
├── 123/                          # Файлы 112 за январь 2026
│   ├── ЧақирувТарихи_112_2026_01_04_00_00_00_2026_01_11_23_59_59.xlsx
│   ├── ЧақирувТарихи_112_2026_01_12_00_00_00_2026_01_18_23_59_59.xlsx
│   ├── ЧақирувТарихи_112_2026_01_19_00_00_00_2026_01_25_23_59_59.xlsx
│   └── ЧақирувТарихи_112_2026_01_26_00_00_00_2026_01_31_23_59_59.xlsx
├── config/                       # Credentials для Google API
│   ├── credentials.json
│   └── token.json
├── data/                         # Локальные данные
│   └── КОНСОЛИДИРОВАННЫЕ_ДАННЫЕ_*.csv
└── reports/                      # Результаты
    └── ЯНВАРЬ_2026_ОТЧЕТ_*.xlsx
```

### Python пакеты
```
pandas
openpyxl
google-auth
google-auth-oauthlib
google-auth-httplib2
google-api-python-client
```

## Результаты

После выполнения скриптов в папке `reports/` появятся файлы:

### 1. `ЯНВАРЬ_2026_ОТЧЕТ_{timestamp}.xlsx`
Excel-файл с результатами сопоставления

### 2. `ЯНВАРЬ_2026_ОТЧЕТ_{timestamp}.csv`
CSV-файл с теми же данными

### Структура результата

Файл содержит:
- **Все колонки из Google Sheets** (оператор, статус, район, жалоба и т.д.)
- **Данные из 112**: служба, статус, район, оператор, дата
- **Дополнительные поля**:
  - `Тип_совпадения` - как было найдено совпадение
  - `Количество_служб_в_инциденте` - сколько служб в данном инциденте
  - `Есть_жалоба` - флаг наличия жалобы
  - `Положительно` - автоматически проставленное значение

## Статистика

Скрипт выводит:
- Количество загруженных записей из Sheets
- Количество загруженных записей из 112
- Количество найденных совпадений
- Процент совпадений
- Распределение по типам совпадений
- Распределение по службам
- Количество жалоб

## Пример вывода

```
================================================================================
СТАТИСТИКА СОПОСТАВЛЕНИЯ
================================================================================

По типам совпадений:
Положительно - несколько служб    450
Положительно - одна служба         120
Жалоба - по номеру карты            30
Не найдено в 112                    25

Всего сопоставлено записей: 600
Всего записей из Sheets: 625
Процент совпадений: 96.0%

Распределение по службам:
  МВД: 250
  МЧС: 200
  Скорая помощь: 150
```

## Важные замечания

1. **Номер карточки** - основной ключ для сопоставления
2. **Номер инцидента** - используется для подсчёта служб
3. **Один инцидент** может иметь несколько карточек (разные службы)
4. **Жалобы** сохраняются как есть
5. **Без жалоб** - автоматически `Положительно`
6. **Дубликаты** удаляются автоматически

## Устранение проблем

### Ошибка: "ЛОКАЛЬНЫЙ ФАЙЛ НЕ НАЙДЕН"
**Решение**: Сначала запустите `python import_sheets_consolidated.py`

### Ошибка: "Не найдено файлов 112"
**Решение**: Проверьте наличие файлов в папке `123/`

### Ошибка при импорте из Google Sheets
**Решение**: 
1. Проверьте наличие файлов в `config/credentials.json` и `config/token.json`
2. Проверьте доступ к интернету
3. Используйте упрощённую версию `process_january_simple.py`

## Обновление

Дата создания: 02.02.2026
Версия: 1.0
